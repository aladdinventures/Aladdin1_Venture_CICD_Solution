# سیستم اتوماسیون یوتیوب نسخه 3.0 - راهنمای استفاده از اسکریپت `install.sh`

**حق چاپ © 2025 سعید علادینی. تمامی حقوق محفوظ است.**

این راهنما دستورالعمل‌های گام به گام را برای نحوه استفاده از اسکریپت `install.sh` جهت استقرار خودکار سیستم اتوماسیون یوتیوب نسخه 3.0 بر روی یک سرور اوبونتو، به ویژه در Oracle Cloud، ارائه می‌دهد.

## 🎯 هدف اسکریپت `install.sh`

اسکریپت `install.sh` کل فرآیند استقرار را خودکار می‌کند، از جمله:
-   بررسی دسترسی `sudo`.
-   نصب Docker و Docker Compose (اگر قبلاً نصب نشده باشند).
-   افزودن کاربر فعلی به گروه `docker`.
-   استخراج فایل‌های پروژه از `youtube_automation_v3.zip`.
-   راهنمایی شما برای پیکربندی فایل `.env`.
-   ساخت ایمیج‌های Docker و راه‌اندازی همه سرویس‌ها (web, db, redis, celery_worker, celery_beat).
-   بررسی وضعیت سرویس‌های مستقر شده.

## 🚀 پیش‌نیازها

قبل از اجرای اسکریپت، اطمینان حاصل کنید که موارد زیر را دارید:

1.  **یک سرور اوبونتو:** ترجیحاً در Oracle Cloud، با دسترسی SSH.
2.  **دسترسی `sudo`:** حساب کاربری شما باید دسترسی `sudo` داشته باشد.
3.  **بسته پروژه:** فایل `youtube_automation_v3.zip` (که قبلاً ارائه شده بود) باید در دسترس باشد.
4.  **اسکریپت `install.sh`:** خود اسکریپت `install.sh` (که قبلاً ارائه شده بود) باید در دسترس باشد.

## 📦 مراحل آماده‌سازی

1.  **آپلود فایل‌ها به سرور خود:**
    هر دو فایل `youtube_automation_v3.zip` و `install.sh` را به دایرکتوری اصلی کاربر خود در سرور اوبونتو منتقل کنید. می‌توانید از `scp` یا هر روش امن انتقال فایل دیگری استفاده کنید.

    ```bash
    # مثال با استفاده از scp از دستگاه محلی شما
    scp /path/to/local/youtube_automation_v3.zip ubuntu@your_server_ip:~/
    scp /path/to/local/install.sh ubuntu@your_server_ip:~/
    ```

2.  **اتصال به سرور خود:**
    از طریق SSH به نمونه اوبونتو Oracle Cloud خود متصل شوید.

    ```bash
    ssh ubuntu@your_server_ip
    ```

## ⚙️ اجرای اسکریپت `install.sh`

پس از اتصال به سرور و آپلود فایل‌ها، این مراحل را دنبال کنید:

1.  **اجرای اسکریپت را فعال کنید:**
    باید مجوزهای اجرایی را به اسکریپت `install.sh` بدهید.

    ```bash
    chmod +x install.sh
    ```

2.  **اسکریپت را اجرا کنید:**
    اسکریپت را از دایرکتوری اصلی خود اجرا کنید.

    ```bash
    ./install.sh
    ```

3.  **دستورالعمل‌های روی صفحه را دنبال کنید:**
    اسکریپت شما را در فرآیند نصب راهنمایی می‌کند:
    -   ابتدا دسترسی `sudo` را بررسی می‌کند.
    -   اگر Docker و Docker Compose یافت نشوند، آنها را نصب می‌کند.
    -   کاربر شما را به گروه `docker` اضافه می‌کند. **مهم:** اگر این اتفاق بیفتد، اسکریپت به شما هشدار می‌دهد که برای اعمال تغییرات باید **از سیستم خارج شده و دوباره وارد شوید (یا سرور را راه‌اندازی مجدد کنید)**. ممکن است لازم باشد قبل از ادامه با دستورات Docker Compose این کار را انجام دهید.
    -   فایل `youtube_automation_v3.zip` را در یک دایرکتوری جدید به نام `youtube_automation_v3` استخراج می‌کند.
    -   سپس از شما می‌خواهد که **فایل `.env` را ویرایش کنید**. این یک مرحله حیاتی است که در آن باید متغیرهای حساس مانند `JWT_SECRET_KEY`، `SECRET_KEY`، رمز عبورهای پایگاه داده و تنظیمات ارائه‌دهنده AI را پیکربندی کنید. اسکریپت `nano .env` را برای شما باز می‌کند. پس از ویرایش، ذخیره کرده و خارج شوید (`Ctrl+X`، سپس `Y`، سپس `Enter`).

4.  **ساخت و راه‌اندازی Docker Compose:**
    پس از پیکربندی فایل `.env`، اسکریپت به طور خودکار به ساخت ایمیج‌های Docker و راه‌اندازی همه سرویس‌ها در حالت جدا شده (`docker compose build` و `docker compose up -d`) ادامه می‌دهد.

5.  **بررسی سرویس‌ها:**
    در نهایت، اسکریپت وضعیت کانتینرهای Docker شما (`docker compose ps`) را نمایش می‌دهد. باید همه سرویس‌ها (web, db, redis, celery_worker, celery_beat) را در وضعیت `Up` مشاهده کنید.

## ✅ پس از نصب

-   **دسترسی به API:** برنامه FastAPI در پورت `8000` سرور شما قابل دسترسی خواهد بود.
    -   **بررسی سلامت (Health Check):** `http://your_server_ip:8000/health`
    -   **مستندات API (Swagger UI):** `http://your_server_ip:8000/docs`
-   **اجرای تست‌ها:** می‌توانید اسکریپت تست API ارائه شده (`test_api.py`) را از داخل دایرکتوری `youtube_automation_v3` برای اعتبارسنجی نقاط پایانی اجرا کنید.
    ```bash
    cd youtube_automation_v3
    python3 test_api.py
    ```

## 🐛 عیب‌یابی

-   **دستور `docker` پس از نصب یافت نشد:** این معمولاً به این معنی است که برای اعمال عضویت در گروه `docker` باید از سیستم خارج شده و دوباره وارد شوید (یا سرور خود را راه‌اندازی مجدد کنید).
-   **کانتینرها راه‌اندازی نمی‌شوند:** لاگ‌های سرویس‌های جداگانه را با استفاده از `docker compose logs <service_name>` (مثلاً `docker compose logs web`) بررسی کنید.
-   **مشکلات پیکربندی `.env`:** فایل `.env` خود را برای مقادیر صحیح، به ویژه رمز عبورها و کلیدهای API، دوباره بررسی کنید.

اگر با مشکلات پایداری مواجه شدید، لطفاً خروجی کامل اسکریپت `install.sh` و هرگونه لاگ مربوط به Docker Compose را ارائه دهید.
